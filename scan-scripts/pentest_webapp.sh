#!/bin/bash
echo 'Running BlackShuck WebApp Pentest...'
# Add scan logic here


TARGET=$1
if [[ -z $TARGET ]]; then
  echo "Usage: ./pentest_webapp.sh http://target.com"
  exit 1
fi

CLEAN_TARGET=$(echo $TARGET | sed 's|https\?://||g' | sed 's|/||g')
OUTDIR="report_$CLEAN_TARGET"
mkdir -p "$OUTDIR"

echo "[*] Starting full recon + vuln scan on $TARGET..."
echo "[*] Output will be saved in $OUTDIR"

# Subdomain Enumeration
sublist3r -d $CLEAN_TARGET -o "$OUTDIR/subdomains.txt"

# Nmap
nmap -Pn -sS -T4 -p- $CLEAN_TARGET -oN "$OUTDIR/nmap.txt"

# WhatWeb
whatweb $TARGET > "$OUTDIR/whatweb.txt"

# Dir bruteforce
gobuster dir -u $TARGET -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -o "$OUTDIR/dirs.txt"

# Nikto
nikto -h $TARGET -o "$OUTDIR/nikto.txt"

# Nuclei
nuclei -u $TARGET -t cves,exposures,misconfiguration -o "$OUTDIR/nuclei.txt"

# SQLMap (on a generic param)
sqlmap -u "$TARGET/index.php?id=1" --batch --crawl=1 --level=2 --risk=2 --output-dir="$OUTDIR/sqlmap" > "$OUTDIR/sqlmap_summary.txt"



REPORT="$OUTDIR/final_report.md"

echo "# Penetration Test Report: $TARGET" > $REPORT
echo "## Recon Summary" >> $REPORT
cat "$OUTDIR/whatweb.txt" >> $REPORT

echo -e "\n## Open Ports (Nmap)" >> $REPORT
grep open "$OUTDIR/nmap.txt" >> $REPORT

echo -e "\n## Directories Found (Gobuster)" >> $REPORT
grep "Status" "$OUTDIR/dirs.txt" >> $REPORT

echo -e "\n## Nikto Results" >> $REPORT
cat "$OUTDIR/nikto.txt" >> $REPORT

echo -e "\n## Nuclei Findings" >> $REPORT
cat "$OUTDIR/nuclei.txt" >> $REPORT

echo -e "\n## SQLMap Summary" >> $REPORT
cat "$OUTDIR/sqlmap_summary.txt" >> $REPORT

echo -e "\n---\nManual testing tips available in 'manual_tips.md'" >> $REPORT

echo "[*] All scanning completed."

